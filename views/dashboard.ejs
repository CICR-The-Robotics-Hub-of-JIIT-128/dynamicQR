<!DOCTYPE html>
<html lang="en">
  <%- include("partials/head2.ejs") %>
  <body>
    <div id="dashboard" class="dashboard container">
      <div class="header">
        <div class="header-content">
          <div class="header-left">
            <h1><i class="fas fa-chart-line"></i> CICR Society Dashboard</h1>
            <p class="header-subtitle">
              Manage event registrations efficiently
            </p>
          </div>
          <div class="header-right">
            <div class="user-info">
              <div class="user-avatar" id="user-avatar">A</div>
              <div class="user-details">
                <span class="welcome-text">Welcome,</span>
                <strong id="username-display" class="username">Admin</strong>
              </div>
              <form action="/logout" method="POST">
                <button type="submit" class="logout-btn">
                  <i class="fas fa-sign-out-alt"></i> Logout
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <h3><i class="fas fa-link"></i> Current Registration Link</h3>
          <span class="status-badge active">
            <i class="fas fa-circle"></i> ACTIVE
          </span>
        </div>
        <div class="card-body">
          <div class="current-link-wrapper">
            <div class="current-link" id="current-link">
              <% if(activeLink) { %> <%= activeLink.url %> <% } else { %> No
              active link is set. <% } %>
            </div>
            <div class="link-stats">
              <div class="stat-item">
                <i class="fas fa-users"></i>
                <span>78 Submissions</span>
              </div>
              <div class="stat-item">
                <i class="fas fa-calendar-alt"></i>
                <span>Jan 10, 2025</span>
              </div>
            </div>
          </div>

          <div class="link-actions">
            <button class="btn btn-copy" onclick="copyLink()">
              <i class="fas fa-copy"></i> Copy Link
            </button>
          </div>
          <div id="link-editor" class="link-editor" style="display: block">
            <h4><i class="fas fa-edit"></i> Update Registration Link</h4>

            <form action="/update-link" method="POST">
              <div class="form-group">
                <label for="new-link-input">New Registration URL</label>
                <input
                  type="url"
                  id="new-link-input"
                  class="form-input"
                  name="newLinkUrl"
                  placeholder="https://example.com/new-registration"
                  required
                />
              </div>
              <div class="link-actions">
                <button type="submit" class="btn btn-success">
                  <i class="fas fa-save"></i> Save Changes
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  onclick="cancelEdit()"
                >
                  <i class="fas fa-times"></i> Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <h3><i class="fas fa-history"></i> Link History & Submissions</h3>
        </div>
        <div class="card-body">
          <div class="stats-row">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-link"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">3</div>
                <div class="stat-label">Total Links</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon success">
                <i class="fas fa-users"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">246</div>
                <div class="stat-label">Total Submissions</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon warning">
                <i class="fas fa-chart-trending-up"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">78</div>
                <div class="stat-label">Active Submissions</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon info">
                <i class="fas fa-calendar-week"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">15</div>
                <div class="stat-label">This Week</div>
              </div>
            </div>
          </div>

          <div class="table-container">
            <table class="history-table">
              <thead>
                <tr>
                  <th><i class="fas fa-link"></i> Registration Link</th>
                  <th><i class="fas fa-calendar"></i> Date Created</th>
                  <th><i class="fas fa-info-circle"></i> Status</th>
                  <th><i class="fas fa-cogs"></i> Actions</th>
                </tr>
              </thead>
              <tbody id="history-table-body">
                <% if (links.length > 0) { %> <% links.forEach(link => { %>
                <tr>
                  <td><%= link.url %></td>
                  <td><%= link.createdAt.toLocaleDateString() %></td>
                  <td>
                    <%# This part dynamically shows the status badge %> <% if
                    (link.isActive) { %>
                    <span class="status-badge active">
                      <i class="fas fa-circle"></i> ACTIVE
                    </span>
                    <% } else { %>
                    <span class="status-badge inactive">
                      <i class="fas fa-circle"></i> INACTIVE
                    </span>
                    <% } %>
                  </td>
                  <td>
                    <%# This part shows the button ONLY for inactive links %> <%
                    if (!link.isActive) { %>
                    <form
                      action="/set-active/<%= link._id %>"
                      method="POST"
                      style="margin: 0"
                    >
                      <button type="submit" class="btn btn-success">
                        Set Active
                      </button>
                    </form>
                    <% } %>
                  </td>
                </tr>
                <% }) %> <% } else { %>
                <tr>
                  <td colspan="4" style="text-align: center">
                    No link history found.
                  </td>
                </tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
